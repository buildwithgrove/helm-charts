# **path-stack Helm chart** <!-- omit in toc -->

![Version: 0.1.0](https://img.shields.io/badge/Version-0.1.0-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![AppVersion: 0.0.16](https://img.shields.io/badge/AppVersion-0.0.16-informational?style=flat-square)

A Helm chart that bundles PATH (PATH API & Toolkit Harness), GUARD (Gateway Utilities for Authentication, Routing & Defense) and WATCH (Workload Analytics and Telemetry for Comprehensive Health) in a single deployment stack.

## Prerequisites

### Installation Prerequisites

1. [Kubernetes](https://kubernetes.io/releases/download/) 1.16+
2. [Helm](https://helm.sh/docs/helm/helm_install/) 3.1+

### Configuration Prerequisites

1. Namespace for **PATH** application (e.g., `app`)
2. Namespace for **WATCH** components (e.g., `monitoring`)

### Create Namespaces

Using `app` and `monitoring` namespaces as an examples:

```bash
kubectl create namespace app
kubectl create namespace monitoring
```

## Configuration Requirements

The configuration requirements for each of the components of the stack can be found in the following links:

- [PATH Docs](./docs/path/path-docs.md)
- [GUARD Docs](./docs/guard/)
- [WATCH Docs](./docs/watch/)

## Deployment Options

### Manual Installation

If you prefer to have more control over the installation process, you can manually create the ConfigMap or Secret and then deploy the chart.

#### Step 1: Create the ConfigMap or Secret <!-- omit in toc -->

Create a ConfigMap from your configuration file:

```bash
kubectl create configmap path-config --from-file=.config.yaml=/path/to/your/.config.yaml -n app
```

For sensitive configuration data, use a Secret instead:

```bash
kubectl create secret generic path-config-secret --from-file=.config.yaml=/path/to/your/.config.yaml -n app
```

#### Step 2: Deploy PATH using Helm <!-- omit in toc -->

There are multiple ways to deploy PATH using Helm, depending on your configuration source.

1. Standard installation with integrated observability:

   ```bash
   helm install path ./path-stack --namespace app
   ```

2. Using a ConfigMap for configuration:

   ```bash
   helm install path ./path-stack \
     --namespace app \
     --set path.fromConfigMap.name=path-config
   ```

3. Using a Secret for configuration:

   ```bash
   helm install path ./path \
     --namespace app \
     --set path.fromSecret.name=path-config-secret
   ```

4. Install without observability

   ```bash
   helm install path ./path-stack --namespace app --set watch.observability.enabled=false
   ```

5. Install with existing Prometheus stack

   ```bash
   helm install path ./path-stack --namespace app \
   --set watch.observability.watch.kube-prometheus-stack.enabled=false \
   --set watch.observability.watch.externalMonitoring.grafanaNamespace=monitoring
   ```

## PATH Stack Values

| Key                               | Type   | Default                                                                                                                                                                                                                                                                                                                                          | Description                                                                                                                                                                                                               |
| --------------------------------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| extraObjects                      | list   | `[]`                                                                                                                                                                                                                                                                                                                                             | extraObjects provides a mechanism insert additional resources which may be needed but are not part of this chart by default.                                                                                              |
| fullnameOverride                  | string | `"path-stack"`                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                           |
| global.securityContext.fsGroup    | int    | `1001`                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                           |
| global.securityContext.runAsGroup | int    | `1001`                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                           |
| global.securityContext.runAsUser  | int    | `1001`                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                           |
| global.serviceAccount.create      | bool   | `true`                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                           |
| global.serviceAccount.name        | string | `"path-stack-sa"`                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                           |
| guard.auth                        | object | `{"apiKey":{"apiKeys":[],"enabled":false,"headerKey":""},"groveLegacy":{"enabled":false}}`                                                                                                                                                                                                                                                       | auth provides the authentication mechanism used to interact with PATH.                                                                                                                                                    |
| guard.auth.apiKey                 | object | `{"apiKeys":[],"enabled":false,"headerKey":""}`                                                                                                                                                                                                                                                                                                  | apiKey is meant to be the default authentication mechanism for every brand new user of PATH.                                                                                                                              |
| guard.auth.groveLegacy            | object | `{"enabled":false}`                                                                                                                                                                                                                                                                                                                              | This configuration is meant to exist for backwards compatibility only and will be deprecated.                                                                                                                             |
| guard.domain                      | string | `"example.org"`                                                                                                                                                                                                                                                                                                                                  | this chart scope.                                                                                                                                                                                                         |
| guard.gateway.port                | int    | `3070`                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                           |
| guard.middlewarePort              | int    | `3000`                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                           |
| guard.middlewareServiceName       | string | `"middleware-http"`                                                                                                                                                                                                                                                                                                                              | This configuration provides the ability to perform traffic shifting from an existing gateway to PATH. TODO_UPNEXT(@HebertCL): Change this configuration field names if traffic splitting is expected to persist in GUARD. |
| guard.name                        | string | `"guard"`                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                           |
| guard.nameOverride                | string | `""`                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                           |
| guard.serviceName                 | string | `"path-http"`                                                                                                                                                                                                                                                                                                                                    | serviceName declares the backend service to which GUARD routes will send traffic to.                                                                                                                                      |
| guard.servicePort                 | int    | `3069`                                                                                                                                                                                                                                                                                                                                           | servicePort sets the default port used by PATH service.                                                                                                                                                                   |
| guard.services                    | list   | `[]`                                                                                                                                                                                                                                                                                                                                             | This field supports aliases and traffic splitting capabilities.                                                                                                                                                           |
| path.additionalAnnotations        | object | `{}`                                                                                                                                                                                                                                                                                                                                             | additionalAnnotations allow adding resource-wide annotations for extra functionality.                                                                                                                                     |
| path.additionalLabels             | object | `{}`                                                                                                                                                                                                                                                                                                                                             | additionalLabels to include in resource's metadata.                                                                                                                                                                       |
| path.fromConfigMap                | object | `{}`                                                                                                                                                                                                                                                                                                                                             | Such configMap is created outside the scope of this chart.                                                                                                                                                                |
| path.fromSecret                   | object | `{}`                                                                                                                                                                                                                                                                                                                                             | Such secret is created outside the scope of this chart.                                                                                                                                                                   |
| path.horizontalPodAutoscaler      | object | `{"enabled":false}`                                                                                                                                                                                                                                                                                                                              | horizontalPodAutoscaler provide HPA capabilities to PATH deployment. Conflicts with replicas.                                                                                                                             |
| path.image.pullPolicy             | string | `"Always"`                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                           |
| path.image.repository             | string | `"ghcr.io/buildwithgrove/path"`                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                           |
| path.image.tag                    | string | `"main"`                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                           |
| path.livenessProbe                | object | `{}`                                                                                                                                                                                                                                                                                                                                             | # Pod liveness probe. Set to high value to account for the potential long response time of the QoS service.                                                                                                               |
| path.name                         | string | `"path"`                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                           |
| path.nameOverride                 | string | `""`                                                                                                                                                                                                                                                                                                                                             | nameOverride allows override of a standard name defined by the chart.                                                                                                                                                     |
| path.persistence                  | object | `{}`                                                                                                                                                                                                                                                                                                                                             | persistence provides a mechanism to create PVCs.                                                                                                                                                                          |
| path.ports                        | list   | `[]`                                                                                                                                                                                                                                                                                                                                             | ports supports the creation of services tied to the ports declared below.                                                                                                                                                 |
| path.readinessProbe               | object | `{}`                                                                                                                                                                                                                                                                                                                                             | # Pod readiness probe. Set to high value to account for the potential long response time of the QoS service.                                                                                                              |
| path.replicas                     | int    | `1`                                                                                                                                                                                                                                                                                                                                              | Number of pod replicas. Conflicts with horizontalPodAutoscaler.                                                                                                                                                           |
| path.resources                    | object | `{}`                                                                                                                                                                                                                                                                                                                                             | resources define requests and limits for PATH deployment.                                                                                                                                                                 |
| path.startupProbe                 | object | `{}`                                                                                                                                                                                                                                                                                                                                             | # Pod startup probe.                                                                                                                                                                                                      |
| watch.dashboards                  | object | `{"custom":{"dashboards":{},"enabled":false},"enabled":false,"guard":{"enabled":true,"folderName":"GUARD"},"label":"grafana","namespace":"monitoring","path":{"enabled":true,"folderName":"PATH"}}`                                                                                                                                              | in kube-prometheus-stack's Grafana. Enable this option to visualize the dashboards in the monitoring stack created above.                                                                                                 |
| watch.dashboards.custom           | object | `{"dashboards":{},"enabled":false}`                                                                                                                                                                                                                                                                                                              | Custom Dashboards - can be provided through values                                                                                                                                                                        |
| watch.dashboards.guard            | object | `{"enabled":true,"folderName":"GUARD"}`                                                                                                                                                                                                                                                                                                          | GUARD Dashboard Configuration                                                                                                                                                                                             |
| watch.dashboards.namespace        | string | `"monitoring"`                                                                                                                                                                                                                                                                                                                                   | namespace required by kube-prometheus-stack                                                                                                                                                                               |
| watch.dashboards.path             | object | `{"enabled":true,"folderName":"PATH"}`                                                                                                                                                                                                                                                                                                           | PATH Dashboard Configuration                                                                                                                                                                                              |
| watch.enabled                     | bool   | `false`                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                           |
| watch.kube-prometheus-stack       | object | `{"enabled":false}`                                                                                                                                                                                                                                                                                                                              | Enable this option only if you don't have an existing monitoring option already.                                                                                                                                          |
| watch.name                        | string | `""`                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                           |
| watch.nameOverride                | string | `""`                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                           |
| watch.serviceMonitors             | object | `{"guard":{"enabled":true,"endpoints":[{"interval":"15s","path":"/metrics","port":"metrics"}],"selector":{"matchLabels":{"app.kubernetes.io/name":"guard"}}},"namespace":"monitoring","path":{"enabled":true,"endpoints":[{"interval":"15s","path":"/metrics","port":"metrics"}],"selector":{"matchLabels":{"app.kubernetes.io/name":"path"}}}}` | This configuration is used by kube-prometheus-stack.                                                                                                                                                                      |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.14.2](https://github.com/norwoodj/helm-docs/releases/v1.14.2)
